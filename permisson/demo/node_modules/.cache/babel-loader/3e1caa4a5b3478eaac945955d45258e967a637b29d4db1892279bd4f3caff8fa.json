{"ast":null,"code":"import \"core-js/modules/es.array.with.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { reactive, toRefs, ref } from 'vue';\nimport { createDirectus, rest, readItems } from '@directus/sdk';\nimport { message } from 'ant-design-vue';\nimport { $categorieslist, $addProduct } from '../../api/proinfo.js';\nexport default {\n  __name: 'productsinfo',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n\n    // import addProduct from '../../components/product/addProduct.vue'\n    const searchKeyword = ref('');\n    const open = ref(false);\n    const formRef = ref();\n    const afterOpenChange = bool => {\n      formRef.value.resetFields();\n    };\n    const showDrawer = () => {\n      open.value = true;\n    };\n    // 数据源\n    let dataSource = reactive({\n      tableDatas: [],\n      // 确保 dataSource.tableDatas 一开始是空数组\n      tableColumns: [{\n        title: '产品id',\n        dataIndex: 'id',\n        key: 'id'\n      }, {\n        title: '产品名称',\n        dataIndex: 'name'\n      }, {\n        title: '价格',\n        dataIndex: 'price'\n      }, {\n        title: '类别',\n        dataIndex: 'categories.name'\n      }, {\n        title: '操作',\n        dataIndex: 'operation'\n      }],\n      formState: {\n        name: '',\n        price: '',\n        categories: {\n          create: [{\n            categories_id: ''\n          } // 关联类别的 ID // 如果有多个类别\n          ]\n        }\n      },\n      categoriesList: []\n    });\n    // 使用 `toRefs` 解构 `reactive` 数据，方便在模板中直接使用\n    let {\n      tableDatas,\n      tableColumns,\n      formState,\n      categoriesList\n    } = toRefs(dataSource);\n    let onFinish = () => {\n      const newProduct = {\n        name: dataSource.formState.name,\n        price: dataSource.formState.price,\n        categories: {\n          create: [{\n            categories_id: dataSource.formState.categories\n          } // 关联类别的 ID // 如果有多个类别\n          ]\n        }\n      };\n      console.log(newProduct);\n      $addProduct(newProduct).then(response => {\n        console.log(\"Product added successfully:\", response);\n        loadData();\n      }).catch(error => {\n        console.error(\"Failed to add product:\", error);\n      });\n      // const selectedCategoryName = formState.categories;\n      // const selectedCategory = dataSource.categoriesList.find(\n      //   (category) => category.name === selectedCategoryName\n      // );\n\n      // if (selectedCategory) {\n      //   // 将类别的 id 赋值给 formState.categories\n      //   formState.categories = selectedCategory.id;\n      // }\n      // const payload = {\n      //   name: dataSource.formState.name,\n      //   price: dataSource.formState.price,\n      //   categories: {\n      //     create: [{ id: dataSource.formState.categories }] // 将选中的 category id 转换为对象\n      //   }\n      // };\n\n      // console.log(dataSource.formState);\n      // $addProduct(dataSource.formState);\n      // $addProduct({\n      //   name: 666,\n      //   price: 12312312,\n      //   categories:  [ { id:'2'} ]   // 直接传递完整的 categories 对象\n      // });\n    };\n    let onClear = () => {\n      formRef.value.resetFields();\n    };\n    let onDelete = no => {\n      console.log(no);\n    };\n    const client = createDirectus('http://localhost:8055').with(rest());\n    let loadCate = () => {\n      $categorieslist().then(r => {\n        dataSource.categoriesList = r.map(item => ({\n          id: item.id,\n          name: item.name\n        }));\n        // console.log(r);\n      });\n    };\n    let loadData = async (searchKeyword = '') => {\n      try {\n        const filter = searchKeyword ? {\n          filter: {\n            name: {\n              _contains: searchKeyword // 直接查询包含关键字的产品\n            }\n          }\n        } : {};\n        const result = await client.request(readItems('products', {\n          fields: ['categories', {\n            categories: [{\n              item: {\n                categories: ['name']\n              }\n            }]\n          }],\n          ...filter\n        }));\n        // let cate=result.categories.id\n        // 将返回的数据赋值给 tableDatas\n        tableDatas.value = result;\n        console.log(tableDatas);\n      } catch (error) {\n        console.error('Failed to fetch items:', error);\n      }\n    };\n    loadData();\n    loadCate();\n    let onSearch = value => {\n      searchKeyword.value = value;\n      loadData(value); // 传递搜索内容\n    };\n    const __returned__ = {\n      searchKeyword,\n      open,\n      formRef,\n      afterOpenChange,\n      showDrawer,\n      get dataSource() {\n        return dataSource;\n      },\n      set dataSource(v) {\n        dataSource = v;\n      },\n      get tableDatas() {\n        return tableDatas;\n      },\n      set tableDatas(v) {\n        tableDatas = v;\n      },\n      get tableColumns() {\n        return tableColumns;\n      },\n      set tableColumns(v) {\n        tableColumns = v;\n      },\n      get formState() {\n        return formState;\n      },\n      set formState(v) {\n        formState = v;\n      },\n      get categoriesList() {\n        return categoriesList;\n      },\n      set categoriesList(v) {\n        categoriesList = v;\n      },\n      get onFinish() {\n        return onFinish;\n      },\n      set onFinish(v) {\n        onFinish = v;\n      },\n      get onClear() {\n        return onClear;\n      },\n      set onClear(v) {\n        onClear = v;\n      },\n      get onDelete() {\n        return onDelete;\n      },\n      set onDelete(v) {\n        onDelete = v;\n      },\n      client,\n      get loadCate() {\n        return loadCate;\n      },\n      set loadCate(v) {\n        loadCate = v;\n      },\n      get loadData() {\n        return loadData;\n      },\n      set loadData(v) {\n        loadData = v;\n      },\n      get onSearch() {\n        return onSearch;\n      },\n      set onSearch(v) {\n        onSearch = v;\n      },\n      reactive,\n      toRefs,\n      ref,\n      get createDirectus() {\n        return createDirectus;\n      },\n      get rest() {\n        return rest;\n      },\n      get readItems() {\n        return readItems;\n      },\n      get message() {\n        return message;\n      },\n      get $categorieslist() {\n        return $categorieslist;\n      },\n      get $addProduct() {\n        return $addProduct;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["reactive","toRefs","ref","createDirectus","rest","readItems","message","$categorieslist","$addProduct","searchKeyword","open","formRef","afterOpenChange","bool","value","resetFields","showDrawer","dataSource","tableDatas","tableColumns","title","dataIndex","key","formState","name","price","categories","create","categories_id","categoriesList","onFinish","newProduct","console","log","then","response","loadData","catch","error","onClear","onDelete","no","client","with","loadCate","r","map","item","id","filter","_contains","result","request","fields","onSearch"],"sources":["E:/permisson/demo/src/views/products/productsinfo.vue"],"sourcesContent":["<template>\r\n  <div class=\"search\">\r\n    <a-input-search class=\"searchText\" v-model:value=\"searchKeyword\" placeholder=\"请输入产品名称\" enter-button=\"查询\"\r\n      size=\"default\" @search=\"onSearch\" />\r\n    <a-button type=\"primary\" class=\"add-a\" @click=\"showDrawer\">添加</a-button>\r\n  </div>\r\n  <a-table :dataSource=\"tableDatas\" :columns=\"tableColumns\" >\r\n  <template #bodyCell=\"{ column, text, record }\">\r\n    <template v-if=\"column.dataIndex === 'operation'\">\r\n        <a-popconfirm\r\n          v-if=\"dataSource.length\"\r\n          title=\"确定删除吗?\"\r\n          @confirm=\"onDelete(record)\"\r\n        >\r\n          <a>Delete</a>\r\n        </a-popconfirm>\r\n      </template>\r\n  </template>\r\n  </a-table>\r\n  <a-drawer v-model:open=\"open\" class=\"custom-class\" root-class-name=\"root-class-name\" :root-style=\"{ color: 'blue' }\"\r\n    style=\"color: red\" title=\"产品添加\" placement=\"right\" @after-open-change=\"afterOpenChange\">\r\n    <a-form :model=\"formState\" v-bind=\"layout\" :validate-messages=\"validateMessages\" :wrapperCol=\"{ span: 16 }\"\r\n      :label-col=\"{ span: 6 }\" ref=\"formRef\" @finish=\"onFinish\">\r\n      <a-form-item name=\"name\" label=\"产品名称\" :rules=\"[{ required: true, message: '请输入产品名称！' }]\">\r\n        <a-input v-model:value=\"formState.name\" />\r\n      </a-form-item>\r\n      <a-form-item name=\"price\" label=\"价格\" :rules=\"[{ required: true, message: '请输入价格！' }]\">\r\n        <a-input v-model:value=\"formState.price\" />\r\n      </a-form-item>\r\n      <a-form-item name=\"categories\" label=\"类别\">\r\n        <a-radio-group v-model:value=\"formState.categories\" name=\"radioGroup\">\r\n          <a-radio v-for=\"(item,index) in categoriesList\":key=\"index\":value=\"item.id\">{{ item.name }}</a-radio>\r\n        </a-radio-group>\r\n      </a-form-item>\r\n      <a-form-item :wrapperCol=\"{ offset: 8, span: 16 }\">\r\n        <a-button class=\"add\" html-type=\"submit\">添加</a-button>\r\n        <a-button class=\"clear\" html-type=\"reset\" @click=\"onClear\">清空</a-button>\r\n      </a-form-item>\r\n    </a-form>\r\n  </a-drawer>\r\n</template>\r\n\r\n<script setup>\r\n// import addProduct from '../../components/product/addProduct.vue'\r\nimport { reactive, toRefs, ref } from 'vue';\r\nimport { createDirectus, rest, readItems } from '@directus/sdk';\r\nimport { message } from 'ant-design-vue';\r\nimport { $categorieslist,$addProduct } from '../../api/proinfo.js'\r\nconst searchKeyword = ref('');\r\nconst open = ref(false);\r\nconst formRef=ref();\r\nconst afterOpenChange = bool => {\r\n  formRef.value.resetFields();\r\n};\r\nconst showDrawer = () => {\r\n  open.value = true;\r\n};\r\n// 数据源\r\nlet dataSource = reactive({\r\n  tableDatas: [],  // 确保 dataSource.tableDatas 一开始是空数组\r\n  tableColumns: [\r\n    {\r\n      title: '产品id',\r\n      dataIndex: 'id',\r\n      key: 'id',\r\n    },\r\n    {\r\n      title: '产品名称',\r\n      dataIndex: 'name'\r\n    },\r\n    {\r\n      title: '价格',\r\n      dataIndex: 'price'\r\n    },\r\n    {\r\n      title: '类别',\r\n      dataIndex: 'categories.name'\r\n    },\r\n    {\r\n      title: '操作',\r\n      dataIndex: 'operation'\r\n    }\r\n  ],\r\n  formState: {\r\n    name: '',\r\n    price: '',\r\n    categories: {create: [\r\n      {categories_id: ''}  , // 关联类别的 ID // 如果有多个类别\r\n    ]\r\n    }\r\n  },\r\n  categoriesList: []\r\n});\r\n// 使用 `toRefs` 解构 `reactive` 数据，方便在模板中直接使用\r\nlet { tableDatas, tableColumns, formState, categoriesList } = toRefs(dataSource);\r\nlet onFinish = () => {\r\n  const newProduct = {\r\n  name: dataSource.formState.name,\r\n  price: dataSource.formState.price,\r\n  categories: {  \r\n    create: [\r\n      {categories_id: dataSource.formState.categories}  , // 关联类别的 ID // 如果有多个类别\r\n    ]\r\n  }\r\n};\r\nconsole.log(newProduct);\r\n$addProduct(newProduct)\r\n  .then(response => {\r\n    console.log(\"Product added successfully:\", response);\r\n    loadData()\r\n  })\r\n  .catch(error => {\r\n    console.error(\"Failed to add product:\", error);\r\n  });\r\n  // const selectedCategoryName = formState.categories;\r\n  // const selectedCategory = dataSource.categoriesList.find(\r\n  //   (category) => category.name === selectedCategoryName\r\n  // );\r\n\r\n  // if (selectedCategory) {\r\n  //   // 将类别的 id 赋值给 formState.categories\r\n  //   formState.categories = selectedCategory.id;\r\n  // }\r\n  // const payload = {\r\n  //   name: dataSource.formState.name,\r\n  //   price: dataSource.formState.price,\r\n  //   categories: {\r\n  //     create: [{ id: dataSource.formState.categories }] // 将选中的 category id 转换为对象\r\n  //   }\r\n  // };\r\n\r\n  // console.log(dataSource.formState);\r\n  // $addProduct(dataSource.formState);\r\n  // $addProduct({\r\n  //   name: 666,\r\n  //   price: 12312312,\r\n  //   categories:  [ { id:'2'} ]   // 直接传递完整的 categories 对象\r\n  // });\r\n}\r\nlet onClear = () => {\r\n  formRef.value.resetFields();\r\n}\r\nlet onDelete=(no)=>{\r\n  console.log(no)\r\n}\r\nconst client = createDirectus('http://localhost:8055').with(rest());\r\nlet loadCate = () => {\r\n  $categorieslist().then(r => {\r\n    dataSource.categoriesList = r.map(item => ({ id: item.id, name: item.name }));\r\n    // console.log(r);\r\n    \r\n  })\r\n}\r\nlet loadData = async (searchKeyword = '') => {\r\n  try {\r\n    const filter = searchKeyword\r\n      ? {\r\n        filter: {\r\n          name: {\r\n            _contains: searchKeyword, // 直接查询包含关键字的产品\r\n          },\r\n        },\r\n      }\r\n      : {};\r\n\r\n    const result = await client.request(readItems('products', {\r\n\t\tfields: [\r\n\t\t\t'categories',\r\n\t\t\t{\r\n\t\t\t\tcategories: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\titem: {\r\n\t\t\t\t\t\t\tcategories: ['name'],\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t}\r\n\t\t],\r\n    ...filter\r\n\t}));\r\n    // let cate=result.categories.id\r\n    // 将返回的数据赋值给 tableDatas\r\n    tableDatas.value = result\r\n    console.log(tableDatas);\r\n    \r\n  } catch (error) {\r\n    console.error('Failed to fetch items:', error);\r\n  }\r\n};\r\nloadData()\r\nloadCate()\r\nlet onSearch = (value) => {\r\n  searchKeyword.value = value;\r\n  loadData(value);  // 传递搜索内容\r\n}\r\n</script>\r\n<style scoped lang=\"scss\">\r\n.search {\r\n  display: flex;\r\n  align-items: center;\r\n  margin-bottom: 10px;\r\n\r\n  .searchText {\r\n    width: 300px;\r\n  }\r\n\r\n  .add-a {\r\n    background: red;\r\n    border: none;\r\n  }\r\n  .add{\r\n    background: #bacf65;\r\n    border: none;\r\n    color:white\r\n  }\r\n  .clear{\r\n     margin-left: 10px;\r\n  }\r\n}\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}